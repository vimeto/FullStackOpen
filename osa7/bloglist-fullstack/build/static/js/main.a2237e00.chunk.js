(this["webpackJsonpbloglist-frontend"]=this["webpackJsonpbloglist-frontend"]||[]).push([[0],{72:function(e,t,c){},73:function(e,t,c){"use strict";c.r(t);var s=c(0),n=c.n(s),r=c(17),i=c.n(r),a=c(3),o=c(2),l=c(75),d=c(1);const j=n.a.forwardRef(((e,t)=>{const[c,n]=Object(s.useState)(!1),r={display:c?"none":""},i={display:c?"":"none"},a=()=>{n(!c)};return Object(s.useImperativeHandle)(t,(()=>({toggleVisibility:a}))),Object(d.jsxs)("div",{children:[Object(d.jsx)("div",{style:r,children:Object(d.jsx)(l.a,{size:"sm",onClick:a,children:e.buttonLabel})}),Object(d.jsxs)("div",{style:i,className:"togglableContent",children:[e.children,Object(d.jsx)(l.a,{size:"sm",onClick:a,children:"cancel"})]})]})}));j.displayName="Togglable";var b=j;const u=(e,t)=>{const[c,n]=Object(s.useState)("");return{toInput:{type:e,value:c,onChange:e=>{n(e.target.value)},placeholder:t},onClear:()=>n("")}};var h=c(10),O=c.n(h);const x="/api/blogs";let p=null;var g=()=>O.a.get(x).then((e=>e.data)),m=async e=>{const t={headers:{Authorization:p}};return(await O.a.post(x,e,t)).data},v=async(e,t)=>(await O.a.put("".concat(x,"/").concat(e),t)).data,y=e=>{p="bearer ".concat(e)},f=async e=>{const t={headers:{Authorization:p}};return(await O.a.delete("".concat(x,"/").concat(e),t)).data},w=async(e,t)=>{const c={comment:t};return(await O.a.post("".concat(x,"/").concat(e,"/comments"),c)).data};const I=(e,t=5)=>async c=>{await c({type:"SET_NOTIFICATION",notification:e}),await new Promise((e=>setTimeout(e,1e3*t))),c({type:"SET_NOTIFICATION",notification:""})};var k=(e=null,t)=>{switch(t.type){case"SET_NOTIFICATION":return t.notification;default:return e}};const S=e=>async t=>{const c={...e,likes:e.likes+1};await v(e.id,c),await t({type:"UPDATE_BLOG",blog:c})};var E=(e=[],t)=>{switch(t.type){case"ADD_BLOG":return e.concat(t.data);case"INITIALIZE_BLOGS":return t.data;case"UPDATE_BLOG":return e.map((e=>e.id===t.blog.id?t.blog:e));case"DELETE_BLOG":{const c=t.blog.id;return e.filter((e=>e.id!==c))}default:return e}};const T=()=>{const e=u("text","author"),t=u("text","title"),c=u("text","url"),n=Object(s.useRef)(),r=Object(a.b)();return Object(d.jsx)(b,{buttonLabel:"new blog",ref:n,children:Object(d.jsxs)("div",{children:[Object(d.jsx)("h2",{children:"Save a new blog"}),Object(d.jsxs)("form",{onSubmit:s=>{n.current.toggleVisibility(),s.preventDefault();const i={author:e.toInput.value,title:t.toInput.value,url:c.toInput.value};m(i).then((e=>{var t;r(I({text:"".concat(e.title," added"),color:"green"})),r((t=e,async e=>{await e({type:"ADD_BLOG",data:t})}))})).catch((e=>{r(I({text:e.message,color:"red"}))})),e.onClear(),t.onClear(),c.onClear()},children:[Object(d.jsx)("input",{...t.toInput}),Object(d.jsx)("input",{...e.toInput}),Object(d.jsx)("input",{...c.toInput}),Object(d.jsx)(l.a,{style:{marginLeft:"5px"},variant:"outline-success",type:"submit",children:"save"})]})]})})};var C=({createBlog:e})=>{const t=Object(a.c)((e=>e.user));return null===t||0===Object.keys(t).length?Object(d.jsx)("p",{children:"You must log in to add new notes"}):Object(d.jsx)(T,{createBlog:e})};var A=()=>{const e=Object(a.c)((e=>e.notification));if(!e)return null;const t={width:"95%",margin:"0 auto 20px auto",border:"2px solid ".concat(e.color),padding:"10px 20px",textAlign:"center",borderRadius:"10px",backgroundColor:"#fff"};return Object(d.jsx)("div",{style:t,children:e.text})},L=c(9);const B=({blog:e})=>{const t=Object(a.b)(),[c,n]=Object(s.useState)(!1),r={display:c?"":"none"},i=e=>{window.confirm("Do you want to delete this post?")&&t((e=>async t=>{try{await f(e.id),await t({type:"DELETE_BLOG",blog:e}),t(I({text:"Post '".concat(e.title,"' deleted"),color:"green"}))}catch(c){401===c.response.status?(console.log("You cannot delete other users posts"),t(I({text:"You cannot delete other users posts",color:"red"}))):(console.log("This post has been deleted elsewhere, try to refresh."),t(I({text:"This post has been deleted elsewhere, try to refresh.",color:"red"})))}})(e))};return Object(d.jsxs)("div",{className:"blog-master-class",style:{margin:"20px 0",backgroundColor:"#fff",padding:"10px",textAlign:"cetner",borderRadius:"10px",boxShadow:"0 0 5px #bbb",border:"1px solid #444",overflow:"hidden"},children:[Object(d.jsxs)("div",{id:"blog-title",children:[Object(d.jsx)(L.b,{to:"/blogs/".concat(e.id),children:e.title})," ",Object(d.jsx)(l.a,{style:{float:"right"},size:"sm",onClick:()=>n(!c),children:c?"hide":"view"})]}),Object(d.jsxs)("div",{style:r,className:"blog-expandable",children:[Object(d.jsx)("div",{id:"blog-url",children:e.url}),Object(d.jsxs)("div",{id:"blog-likes",children:["likes ",e.likes," ",Object(d.jsx)(l.a,{variant:"outline-primary",size:"sm",onClick:()=>(e=>{t(S(e))})(e),children:"like"})]}),Object(d.jsx)("div",{id:"blog-author",children:e.author}),Object(d.jsx)(l.a,{variant:"danger",size:"sm",onClick:()=>i(e),children:"remove"})]})]})};var N=()=>{const e=Object(a.c)((e=>e.blogs));return Object(d.jsx)("div",{children:e.sort(((e,t)=>e.likes<t.likes?1:e.likes>t.likes?-1:0)).map((e=>Object(d.jsx)(B,{blog:e},e.id)))})},_=c(74);var D=({users:e})=>{const t=Object(o.f)();console.log(e);return Object(d.jsxs)("div",{children:[Object(d.jsx)("h2",{children:"Users"}),Object(d.jsx)(_.a,{striped:!0,bordered:!0,hover:!0,children:Object(d.jsxs)("tbody",{children:[Object(d.jsxs)("tr",{children:[Object(d.jsx)("th",{children:"User"}),Object(d.jsx)("th",{children:"blogs created"})]}),e?e.map((e=>Object(d.jsxs)("tr",{children:[Object(d.jsx)("td",{onClick:()=>{return c=e.id,void t.push("/users/".concat(c));var c},children:e.name}),Object(d.jsx)("td",{children:e.blogs.length})]},e.id))):null]})})]})};var U=({user:e})=>(console.log("In Single User",e),e?Object(d.jsxs)("div",{children:[Object(d.jsx)("h2",{children:e.name}),Object(d.jsx)("p",{children:Object(d.jsx)("b",{children:"added blogs"})}),Object(d.jsx)("p",{children:0===e.blogs.length?"no blogs yet":""}),Object(d.jsx)("ul",{children:e.blogs.map((e=>Object(d.jsx)("li",{children:Object(d.jsx)(L.b,{to:"/blogs/".concat(e.id),children:e.title})},e.id)))})]}):null);var z=()=>{const e=Object(a.c)((e=>e.blogs)),t=Object(a.b)(),c=Object(o.g)().id,s=u("text","new comment");if(0===e.filter((e=>e.id===c)).length)return null;const n=e.find((e=>e.id===c));return Object(d.jsxs)("div",{children:[Object(d.jsx)("h2",{children:n.title}),Object(d.jsx)("a",{href:n.url,children:n.url}),Object(d.jsxs)("div",{children:[n.likes," likes ",Object(d.jsx)(l.a,{size:"sm",onClick:()=>{t(S(n))},children:"like"})]}),Object(d.jsxs)("p",{children:["Added by ",n.author]}),Object(d.jsx)("p",{children:Object(d.jsx)("b",{children:"comments"})}),Object(d.jsxs)("div",{children:[Object(d.jsxs)("form",{onSubmit:e=>{e.preventDefault();const c=s.toInput.value;s.onClear(),t(((e,t)=>async c=>{const s=await w(e.id,t);await c({type:"UPDATE_BLOG",blog:s})})(n,c))},children:[Object(d.jsx)("input",{...s.toInput}),Object(d.jsx)(l.a,{style:{marginLeft:"5px"},variant:"outline-success",type:"submit",children:"submit"})]}),Object(d.jsx)("ul",{children:n.comments.map(((e,t)=>Object(d.jsx)("li",{children:e},t)))}),Object(d.jsx)("p",{children:0===n.comments.length?"this post has no comments yet":""})]})]})},G=c(24),R=c(25);var P=async e=>(await O.a.post("api/login",e)).data;const J=e=>async t=>{t({type:"SET_USER",data:e})};var F=(e={},t)=>{switch(t.type){case"SET_USER":return t.data;default:return e}};var Y,V,W=()=>{const e=Object(a.b)(),t=Object(a.c)((e=>e.user)),c=u("text","username"),s=u("password","password"),n=()=>{window.localStorage.clear(),e(J(null))};return null!==t&&0!==Object.keys(t).length?Object(d.jsxs)("div",{children:[t.name," logged in ",Object(d.jsx)(l.a,{size:"sm",onClick:n,children:"logout"}),Object(d.jsx)("br",{})]}):Object(d.jsx)("div",{children:Object(d.jsxs)("form",{onSubmit:t=>{t.preventDefault();try{e(((e,t)=>async c=>{console.log(e,t);const s=await P({username:e,password:t});return window.localStorage.setItem("loggedBlogAppUser",JSON.stringify(s)),y(s.token),await c({type:"SET_USER",data:s}),s})(c.toInput.value,s.toInput.value)).then((t=>{e(I({text:"".concat(t.name," logged in"),color:"green"}))}))}catch(n){e(I({text:"Wrong credentials",color:"red"}))}},children:[Object(d.jsx)("input",{...c.toInput}),Object(d.jsx)("input",{...s.toInput}),Object(d.jsx)(l.a,{size:"sm",type:"submit",children:"log in"})]})})};const Z=R.a.div(Y||(Y=Object(G.a)(["\n  width: 100%;\n  height: fit-content;\n  background-color: white;\n  border-bottom: 1px solid black;\n  padding: 10px 0;\n  margin-bottom: 20px;\n"]))),H=R.a.p(V||(V=Object(G.a)(["\n  padding: 0;\n  margin: 10px 30px;\n  font-size: 1.2rem;\n  display: inline;\n"])));var M=()=>Object(d.jsxs)(Z,{children:[Object(d.jsx)(L.b,{to:"/",children:Object(d.jsx)(H,{children:"Blogs"})}),Object(d.jsx)(L.b,{to:"/users",children:Object(d.jsx)(H,{children:"Users"})}),Object(d.jsx)("div",{style:{display:"inline-block"},children:Object(d.jsx)(W,{})})]});var q=()=>O.a.get("/api/users").then((e=>e.data));var K=()=>{const e=Object(a.b)(),[t,c]=Object(s.useState)(null),n=Object(a.c)((e=>e.blogs));Object(s.useEffect)((()=>{e((async e=>{const t=await g();await e({type:"INITIALIZE_BLOGS",data:t})}))}),[]),Object(s.useEffect)((()=>{const t=window.localStorage.getItem("loggedBlogAppUser");if(t){const c=JSON.parse(t);y(c.token),e(J(c))}}),[]),Object(s.useEffect)((()=>{q().then((e=>c(e)))}),[]);const r=Object(o.h)("/users/:id"),i=r&&t?t.find((e=>e.id===r.params.id)):null;return Object(d.jsxs)("div",{className:"container",children:[Object(d.jsx)(M,{}),Object(d.jsx)(A,{}),Object(d.jsx)("h1",{children:"BLOG APP"}),Object(d.jsxs)(o.c,{children:[Object(d.jsx)(o.a,{path:"/users/:id",children:Object(d.jsx)(U,{user:i})}),Object(d.jsx)(o.a,{path:"/users",children:Object(d.jsx)(D,{users:t})}),Object(d.jsx)(o.a,{path:"/blogs/:id",children:Object(d.jsx)(z,{blogs:n})}),Object(d.jsxs)(o.a,{path:"/",children:[Object(d.jsx)(C,{}),Object(d.jsx)(N,{})]})]})]})},Q=c(16),X=c(41),$=c(42);const ee=Object(Q.combineReducers)({notification:k,blogs:E,user:F});var te=Object(Q.createStore)(ee,Object(X.composeWithDevTools)(Object(Q.applyMiddleware)($.a)));c(72);i.a.render(Object(d.jsx)(a.a,{store:te,children:Object(d.jsx)(L.a,{children:Object(d.jsx)(K,{})})}),document.getElementById("root"))}},[[73,1,2]]]);
//# sourceMappingURL=main.a2237e00.chunk.js.map